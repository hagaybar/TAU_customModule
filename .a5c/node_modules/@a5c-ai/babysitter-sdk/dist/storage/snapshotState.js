"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.snapshotState = snapshotState;
const paths_1 = require("./paths");
const atomic_1 = require("./atomic");
const clock_1 = require("./clock");
async function snapshotState(options) {
    const payload = {
        journalHead: options.journalHead ?? null,
        savedAt: (0, clock_1.getClockIsoString)(),
        state: options.state,
    };
    await (0, atomic_1.writeFileAtomic)((0, paths_1.getStateFile)(options.runDir), JSON.stringify(payload, null, 2) + "\n");
    return payload;
}
